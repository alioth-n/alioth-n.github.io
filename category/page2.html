<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin: 20px 0;
            color: #f0a500;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* ç•«é¢åˆ‡æ› */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ç•«é¢1: å•é¡Œè¼¸å…¥ */
        .question-screen {
            max-width: 700px;
            margin: 50px auto;
        }

        .question-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            border: 1px solid rgba(240, 165, 0, 0.3);
        }

        .question-title {
            font-size: 1.8em;
            color: #f0a500;
            margin-bottom: 30px;
            text-align: center;
        }

        .question-subtitle {
            font-size: 1.1em;
            color: #b0b0b0;
            margin-bottom: 25px;
            text-align: center;
            line-height: 1.6;
        }

        .question-input {
            width: 100%;
            padding: 20px;
            font-size: 1.2em;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(240, 165, 0, 0.5);
            border-radius: 10px;
            color: #e0e0e0;
            outline: none;
            transition: all 0.3s ease;
            margin-bottom: 30px;
        }

        .question-input:focus {
            border-color: #f0a500;
            box-shadow: 0 0 15px rgba(240, 165, 0, 0.3);
        }

        .button {
            display: block;
            width: 100%;
            padding: 18px;
            font-size: 1.3em;
            background: linear-gradient(135deg, #f0a500, #e09200);
            color: #1a1a2e;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(240, 165, 0, 0.4);
            transition: all 0.3s ease;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(240, 165, 0, 0.6);
        }

        .button:active {
            transform: translateY(0);
        }

        .button:disabled {
            background: #555;
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.5;
        }

        /* ç•«é¢2: å åœé€²è¡Œä¸­ */
        .divination-screen {
            max-width: 1000px;
            margin: 0 auto;
        }

        .question-display {
            font-size: 1.5em;
            color: #f0a500;
            text-align: center;
            padding: 20px;
            background: rgba(240, 165, 0, 0.1);
            border-radius: 10px;
            border: 2px solid #f0a500;
            margin-bottom: 20px;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(240, 165, 0, 0.3);
        }

        .status {
            font-size: 1.2em;
            text-align: center;
            margin-bottom: 10px;
            color: #f0a500;
        }

        .instruction {
            text-align: center;
            font-size: 1em;
            color: #b0b0b0;
        }

        .error-message {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            border: 2px solid #ff6b6b;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-size: 1.1em;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .grid-layout {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 30px auto;
        }

        .grid-row {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .grid-cell {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(240, 165, 0, 0.3);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            position: relative;
            min-height: 120px;
            transition: all 0.3s ease;
        }

        .grid-cell.small {
            width: 150px;
        }

        .grid-cell.large {
            flex: 1;
            max-width: 600px;
        }

        .grid-cell.active {
            background: rgba(240, 165, 0, 0.1);
            border-color: #f0a500;
            box-shadow: 0 0 20px rgba(240, 165, 0, 0.3);
        }

        .grid-cell-label {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 0.7em;
            color: #808080;
        }

        .sticks-area {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }

        .stick {
            width: 3px;
            height: 30px;
            background: linear-gradient(to bottom, #8B4513, #D2691E);
            border-radius: 2px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .stick.horizontal {
            width: 30px;
            height: 3px;
            transform: rotate(45deg);
        }

        .stick.moving {
            animation: moveStick 0.8s ease;
        }

        @keyframes moveStick {
            0% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
            50% {
                transform: scale(1.3) translateY(-20px);
                opacity: 0.7;
            }
            100% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .stick-count {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 1.2em;
            font-weight: bold;
            color: #f0a500;
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 8px;
            border-radius: 5px;
        }

        .dividing-interface {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .piles-display {
            display: flex;
            width: 100%;
            justify-content: space-around;
            align-items: flex-end;
            min-height: 150px;
        }

        .pile {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .pile-label {
            font-size: 1em;
            color: #f0a500;
            margin-bottom: 10px;
        }

        .pile-sticks {
            display: flex;
            flex-wrap: nowrap;
            gap: 2px;
            justify-content: center;
            overflow-x: auto;
            max-width: 100%;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #f0a500;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(240, 165, 0, 0.5);
            transition: all 0.2s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(240, 165, 0, 0.7);
        }

        .slider::-moz-range-thumb {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #f0a500;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(240, 165, 0, 0.5);
            border: none;
            transition: all 0.2s ease;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .button.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            border: 2px solid rgba(240, 165, 0, 0.5);
        }

        .button.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #f0a500;
        }

        /* ç•«é¢3: å åœçµæœ */
        .result-screen {
            max-width: 800px;
            margin: 0 auto;
        }

        .results-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(240, 165, 0, 0.3);
            margin-bottom: 30px;
        }

        .results-title {
            text-align: center;
            font-size: 1.8em;
            color: #f0a500;
            margin-bottom: 25px;
        }

        .results-grid {
            display: flex;
            flex-direction: column-reverse;
            gap: 10px;
            max-width: 400px;
            margin: 0 auto 30px;
        }

        .result-item {
            background: rgba(240, 165, 0, 0.1);
            border: 2px solid #f0a500;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .result-item:hover {
            background: rgba(240, 165, 0, 0.15);
            transform: translateX(5px);
        }

        .result-label {
            font-size: 1.1em;
            color: #e0e0e0;
        }

        .result-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #f0a500;
        }

        /* ç•«é¢4&5: å•å·é é¢ */
        .survey-screen {
            max-width: 900px;
            margin: 0 auto;
        }

        .survey-intro {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid rgba(240, 165, 0, 0.3);
        }

        .survey-intro h2 {
            color: #f0a500;
            font-size: 1.6em;
            margin-bottom: 20px;
            text-align: center;
        }

        .survey-intro p {
            font-size: 1.1em;
            line-height: 1.8;
            color: #c0c0c0;
            margin-bottom: 15px;
        }

        .survey-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .survey-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(240, 165, 0, 0.3);
            min-height: 600px;
        }

        .survey-container iframe {
            width: 100%;
            min-height: 800px;
            border: none;
            border-radius: 10px;
        }

        .navigation-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        /* è¼‰å…¥å‹•ç•« */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(240, 165, 0, 0.2);
            border-top: 4px solid #f0a500;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #f0a500;
            font-size: 1.2em;
        }

.ul1 {
    list-style-type: none;
    margin: 0;
    padding: 0;
    overflow: hidden;
    border: 1px solid #e7e7e7;
    background-color: #f3f3f3;
}


li a {
    float: left;
    display: block;
    color: #666;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
}

li a:hover:not(.active) {
    background-color: #ddd;
}

li a.active {
    color: white;
    background-color: #4CAF50;
}
img {
    max-width: 100%;
    max-height: 100%;
}

</style>

<title>é›»è…¦ä½œå“é </title>
</head>
<body>

<ul class="ul1">
    <li><a href="../index.html">é¦–é -ä»‹ç´¹é </a></li>
    <li><a href="page1.html">æ–‡ç« ä½œå“é </a></li>
    <li><a class="active" href="">é›»è…¦ä½œå“é </a></li>
    <li><a href="page3.html">æµæµªåœ°çƒ</a></li>
</ul>
<hr>
    <div class="container">
        <h1>â˜¯ æ˜“ç¶“å¤§è¡å åœ â˜¯</h1>

        <!-- ==================== ç•«é¢1: å•é¡Œè¼¸å…¥ ==================== -->
        <div class="screen active" id="screen1">
            <div class="question-screen">
                <div class="question-panel">
                    <h2 class="question-title">èª å¿ƒå•åœ</h2>
                    <p class="question-subtitle">è«‹éœå¿ƒæ€è€ƒæ‚¨çš„å•é¡Œï¼Œä»¥èª æ‘¯çš„å¿ƒæ…‹é€²è¡Œå åœã€‚<br>å•é¡Œè¶Šå…·é«”æ˜ç¢ºï¼Œå åœçµæœè¶Šæœ‰åƒè€ƒåƒ¹å€¼ã€‚</p>
                    <input type="text" class="question-input" id="questionInput" placeholder="ä¾‹å¦‚ï¼šä»Šå¹´äº‹æ¥­ç™¼å±•å¦‚ä½•ï¼Ÿæˆ‘è©²å¦‚ä½•æ”¹å–„èˆ‡ä¼´ä¾¶çš„é—œä¿‚ï¼Ÿ">
                    <button class="button" id="startButton">é–‹å§‹å åœ</button>
                </div>
            </div>
        </div>

        <!-- ==================== ç•«é¢2: å åœé€²è¡Œä¸­ ==================== -->
        <div class="screen" id="screen2">
            <div class="divination-screen">
                <div class="question-display" id="questionDisplay"></div>

                <div class="info-panel">
                    <div class="status" id="status">æº–å‚™ä¸­...</div>
                    <div class="instruction" id="instruction">ç³»çµ±æº–å‚™ä¸­</div>
                </div>

                <div id="errorMessage" style="display: none;"></div>

                <div class="grid-layout">
                    <!-- ç¬¬ä¸€æ’ -->
                    <div class="grid-row">
                        <div class="grid-cell small" id="cell-top-left">
                            <span class="grid-cell-label">å·¦ä¸Š</span>
                            <div class="sticks-area" id="sticks-top-left"></div>
                        </div>
                        <div class="grid-cell small" id="cell-top-center">
                            <span class="grid-cell-label">ä¸­ä¸Š</span>
                            <div class="sticks-area" id="sticks-top-center"></div>
                        </div>
                        <div class="grid-cell small" id="cell-top-right">
                            <span class="grid-cell-label">å³ä¸Š</span>
                            <div class="sticks-area" id="sticks-top-right"></div>
                        </div>
                    </div>

                    <!-- ç¬¬äºŒæ’ -->
                    <div class="grid-row">
                        <div class="grid-cell large" id="cell-middle">
                            <span class="grid-cell-label">æ“ä½œå€</span>
                            <div id="middleContent"></div>
                        </div>
                    </div>

                    <!-- ç¬¬ä¸‰æ’ -->
                    <div class="grid-row">
                        <div class="grid-cell small" id="cell-bottom-left">
                            <span class="grid-cell-label">å·¦ä¸‹</span>
                            <div class="sticks-area" id="sticks-bottom-left"></div>
                        </div>
                        <div class="grid-cell small" id="cell-bottom-center">
                            <span class="grid-cell-label">ä¸­ä¸‹</span>
                            <div class="sticks-area" id="sticks-bottom-center"></div>
                        </div>
                        <div class="grid-cell small" id="cell-bottom-right">
                            <span class="grid-cell-label">å³ä¸‹</span>
                            <div class="sticks-area" id="sticks-bottom-right"></div>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="button" id="continueButton" style="display: none;">ç¹¼çºŒä¸‹ä¸€çˆ»</button>
                    <button class="button secondary" id="resetButton">é‡æ–°å åœ</button>
                </div>
            </div>
        </div>

        <!-- ==================== ç•«é¢3: å åœçµæœ ==================== -->
        <div class="screen" id="screen3">
            <div class="result-screen">
                <div class="question-display" id="resultQuestionDisplay"></div>

                <div class="results-panel">
                    <h2 class="results-title">å åœçµæœ</h2>
                    <div class="results-grid" id="resultsGrid"></div>
                    <div class="navigation-buttons">
                        <button class="button" id="toSurveyButton">æŸ¥çœ‹è§£è®€èˆ‡å¡«å¯«å•å·</button>
                        <button class="button secondary" id="resetFromResultButton">é‡æ–°å åœ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== ç•«é¢4: å åœçµæœå•å· ==================== -->
        <div class="screen" id="screen4">
            <div class="survey-screen">
                <div class="question-display" id="surveyQuestionDisplay"></div>

                <div class="survey-intro">
                    <h2>å”åŠ©æˆ‘å€‘æå‡è§£è®€èƒ½åŠ›</h2>
                    <p>å¯ä»¥ä½”ç”¨å…©åˆ†é˜å¡«å€‹å•å·ï¼Œè®“æ‚¨çš„ã€Œå åœçµæœã€ä¾›æˆ‘å€‘ç ”ç©¶å—ï¼Ÿ</p>
                    <p>æˆ‘å€‘æä¾›<strong>ç°¡æ˜“å•å·</strong>å’Œ<strong>è©³ç›¡å•å·</strong>å…©ç¨®é¸æ“‡ï¼Œæ‚¨çš„å›ç­”æœ‰åŠ©æ–¼æå‡æˆ‘å€‘çš„è§£è®€èƒ½åŠ›ï¼</p>
                    <p>æ‚¨å¡«çš„è¡¨å–®æœƒå›ä¿¡çµ¦æ‚¨ï¼Œå¯ä»¥éš¨æ™‚æ›´æ”¹ç­”æ¡ˆã€‚</p>
                    
                    <div class="survey-options">
                        <button class="button" id="showSimpleSurvey">å¡«å¯«ç°¡æ˜“å•å·</button>
                        <button class="button" id="showDetailedSurvey">å¡«å¯«è©³ç›¡å•å·</button>
                        <button class="button secondary" id="skipToFeedback">è·³éï¼Œç›´æ¥å¡«å¯«ä½¿ç”¨å¿ƒå¾—</button>
                    </div>
                </div>

                <div class="survey-container" id="resultSurveyContainer" style="display: none;">
                    <!-- 
                    ==================== Google è¡¨å–®åµŒå…¥ä½ç½® ====================
                    è«‹å°‡æ‚¨çš„ Google è¡¨å–®åµŒå…¥ä»£ç¢¼æ”¾åœ¨é€™è£¡
                    
                    ç°¡æ˜“å•å·ç¯„ä¾‹ï¼š
                    <iframe src="https://docs.google.com/forms/d/e/YOUR_SIMPLE_FORM_ID/viewform?embedded=true" 
                            width="100%" height="800" frameborder="0" marginheight="0" marginwidth="0">
                        è¼‰å…¥ä¸­â€¦
                    </iframe>
                    
                    è©³ç›¡å•å·ç¯„ä¾‹ï¼š
                    <iframe src="https://docs.google.com/forms/d/e/YOUR_DETAILED_FORM_ID/viewform?embedded=true" 
                            width="100%" height="1200" frameborder="0" marginheight="0" marginwidth="0">
                        è¼‰å…¥ä¸­â€¦
                    </iframe>
                    ==================== Google è¡¨å–®åµŒå…¥ä½ç½® ====================
                    -->
                </div>

                <div class="navigation-buttons">
                    <button class="button secondary" id="backToResult">è¿”å›çµæœé </button>
                    <button class="button" id="toFeedbackSurvey">å¡«å¯«ä½¿ç”¨å¿ƒå¾—å•å·</button>
                </div>
            </div>
        </div>

        <!-- ==================== ç•«é¢5: ä½¿ç”¨å¿ƒå¾—å•å· ==================== -->
        <div class="screen" id="screen5">
            <div class="survey-screen">
                <div class="survey-intro">
                    <h2>ä½¿ç”¨å¿ƒå¾—å•å·</h2>
                    <p>æ„Ÿè¬æ‚¨ä½¿ç”¨æ˜“ç¶“å¤§è¡å åœç³»çµ±ï¼</p>
                    <p>è«‹åˆ†äº«æ‚¨çš„ä½¿ç”¨é«”é©—ï¼Œå¹«åŠ©æˆ‘å€‘æ”¹é€²æœå‹™å“è³ªã€‚</p>
                </div>

                <div class="survey-container">
                    <!-- 
                    ==================== Google è¡¨å–®åµŒå…¥ä½ç½® ====================
                    è«‹å°‡æ‚¨çš„ã€Œä½¿ç”¨å¿ƒå¾—å•å·ã€Google è¡¨å–®åµŒå…¥ä»£ç¢¼æ”¾åœ¨é€™è£¡
                    
                    ç¯„ä¾‹ï¼š
                    <iframe src="https://docs.google.com/forms/d/e/YOUR_FEEDBACK_FORM_ID/viewform?embedded=true" 
                            width="100%" height="1000" frameborder="0" marginheight="0" marginwidth="0">
                        è¼‰å…¥ä¸­â€¦
                    </iframe>
                    ==================== Google è¡¨å–®åµŒå…¥ä½ç½® ====================
                    -->
                    
                    <!-- ç¤ºæ„ç”¨çš„ä½”ä½å…§å®¹ -->
                    <div style="padding: 40px; text-align: center; color: #888;">
                        <p style="font-size: 1.2em; margin-bottom: 15px;">ğŸ“ ä½¿ç”¨å¿ƒå¾—å•å·å°‡é¡¯ç¤ºæ–¼æ­¤</p>
                        <p>è«‹åœ¨ä¸Šæ–¹è¨»è§£å€åŸŸæ’å…¥æ‚¨çš„ Google è¡¨å–®åµŒå…¥ä»£ç¢¼</p>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="button secondary" id="backToResultFromFeedback">è¿”å›çµæœé </button>
                    <button class="button" id="finishButton">å®Œæˆ</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // ==================== å¦åå­—å…¸ ====================
        const guaDict = {
            '111111': 'ä¹¾å¦ä¹¾ç‚ºå¤©ä·€',
            '000111': 'å¦å¦å¤©åœ°å¦ä·‹',
            '110111': 'å±¥å¦å¤©æ¾¤å±¥ä·‰',
            '001111': 'é¯å¦å¤©å±±é¯ä· ',
            '101111': 'åŒäººå¦å¤©ç«åŒäººä·Œ',
            '010111': 'è¨Ÿå¦å¤©æ°´è¨Ÿä·…',
            '100111': 'æ— å¦„å¦å¤©é›·æ— å¦„ä·˜',
            '011111': 'å§¤å¦å¤©é¢¨å§¤ä·«',
            
            '111000': 'æ³°å¦åœ°å¤©æ³°ä·Š',
            '000000': 'å¤å¦å¤ç‚ºåœ°ä·',
            '110000': 'è‡¨å¦åœ°æ¾¤è‡¨ä·’',
            '001000': 'è¬™å¦åœ°å±±è¬™ä·',
            '101000': 'æ˜å¤·å¦åœ°ç«æ˜å¤·ä·£',
            '010000': 'å¸«å¦åœ°æ°´å¸«ä·†',
            '100000': 'å¾©å¦åœ°é›·å¾©ä·—',
            '011000': 'å‡å¦åœ°é¢¨å‡ä·­',
            
            '111110': 'å¤¬å¦æ¾¤å¤©å¤¬ä·ª',
            '000110': 'èƒå¦æ¾¤åœ°èƒä·¬',
            '110110': 'å…Œå¦å…Œç‚ºæ¾¤ä·¹',
            '001110': 'å’¸å¦æ¾¤å±±å’¸ä·',
            '101110': 'é©å¦æ¾¤ç«é©ä·°',
            '010110': 'å›°å¦æ¾¤æ°´å›°ä·®',
            '100110': 'éš¨å¦æ¾¤é›·éš¨ä·',
            '011110': 'å¤§éå¦æ¾¤é¢¨å¤§éä·›',
            
            '111001': 'å¤§ç•œå¦å±±å¤©å¤§ç•œä·™',
            '000001': 'å‰å¦å±±åœ°å‰ä·–',
            '110001': 'æå¦å±±æ¾¤æä·¨',
            '001001': 'è‰®å¦è‰®ç‚ºå±±ä·³',
            '101001': 'è³å¦å±±ç«è³ä·•',
            '010001': 'è’™å¦å±±æ°´è’™ä·ƒ',
            '100001': 'é ¤å¦å±±é›·é ¤ä·š',
            '011001': 'è ±å¦å±±é¢¨è ±ä·‘',
            
            '111101': 'å¤§æœ‰å¦ç«å¤©å¤§æœ‰ä·',
            '000101': 'æ™‰å¦ç«åœ°æ™‰ä·¢',
            '110101': 'ç½å¦ç«æ¾¤ç½ä·¥',
            '001101': 'æ—…å¦ç«å±±æ—…ä··',
            '101101': 'é›¢å¦é›¢ç‚ºç«ä·',
            '010101': 'æœªæ¿Ÿå¦ç«æ°´æœªæ¿Ÿä·¿',
            '100101': 'å™¬å—‘å¦ç«é›·å™¬å—‘ä·”',
            '011101': 'é¼å¦ç«é¢¨é¼ä·±',
            
            '111010': 'éœ€å¦æ°´å¤©éœ€ä·„',
            '000010': 'æ¯”å¦æ°´åœ°æ¯”ä·‡',
            '110010': 'ç¯€å¦æ°´æ¾¤ç¯€ä·»',
            '001010': 'è¹‡å¦æ°´å±±è¹‡ä·¦',
            '101010': 'æ—¢æ¿Ÿå¦æ°´ç«æ—¢æ¿Ÿä·¾',
            '010010': 'åå¦åç‚ºæ°´ä·œ',
            '100010': 'å±¯å¦æ°´é›·å±¯ä·‚',
            '011010': 'äº•å¦æ°´é¢¨äº•ä·¯',
            
            '111100': 'å¤§å£¯å¦é›·å¤©å¤§å£¯ä·¡',
            '000100': 'è±«å¦é›·åœ°è±«ä·',
            '110100': 'æ­¸å¦¹å¦é›·æ¾¤æ­¸å¦¹ä·µ',
            '001100': 'å°éå¦é›·å±±å°éä·½',
            '101100': 'è±å¦é›·ç«è±ä·¶',
            '010100': 'è§£å¦é›·æ°´è§£ä·§',
            '100100': 'éœ‡å¦éœ‡ç‚ºé›·ä·²',
            '011100': 'æ’å¦é›·é¢¨æ’ä·Ÿ',
            
            '111011': 'å°ç•œå¦é¢¨å¤©å°ç•œä·ˆ',
            '000011': 'è§€å¦é¢¨åœ°è§€ä·“',
            '110011': 'ä¸­å­šå¦é¢¨æ¾¤ä¸­å­šä·¼',
            '001011': 'æ¼¸å¦é¢¨å±±æ¼¸ä·´',
            '101011': 'å®¶äººå¦é¢¨ç«å®¶äººä·¤',
            '010011': 'æ¸™å¦é¢¨æ°´æ¸™ä·º',
            '100011': 'ç›Šå¦é¢¨é›·ç›Šä·©',
            '011011': 'å·½å¦å·½ç‚ºé¢¨ä·¸'
        };

        // çˆ»çš„åç¨±æ˜ å°„
        const yaoNames = ['åˆçˆ»', 'äºŒçˆ»', 'ä¸‰çˆ»', 'å››çˆ»', 'äº”çˆ»', 'ä¸Šçˆ»'];

        // å°‡æ•¸å­—è½‰æ›ç‚º0/1 (6,8->0; 7,9->1)
        function numberToYao(num) {
            return (num === 7 || num === 9) ? '1' : '0';
        }

        // åˆ¤æ–·æ˜¯å¦ç‚ºè®Šçˆ» (6æˆ–9)
        function isChangingYao(num) {
            return num === 6 || num === 9;
        }

        // è¨ˆç®—å¦åå’Œè®Šçˆ»
        function calculateGua(results) {
            // å°‡å…­å€‹æ•¸å­—è½‰æ›ç‚ºäºŒé€²åˆ¶å­—ç¬¦ä¸²
            const binaryStr = results.map(numberToYao).join('');
            
            // æŸ¥æ‰¾å¦å
            const guaName = guaDict[binaryStr] || 'æœªçŸ¥å¦';
            
            // æ‰¾å‡ºè®Šçˆ»ä½ç½®
            const changingYaos = [];
            results.forEach((num, index) => {
                if (isChangingYao(num)) {
                    changingYaos.push(yaoNames[index]);
                }
            });
            
            return {
                guaName: guaName,
                changingYaos: changingYaos,
                binaryStr: binaryStr
            };
        }

        // ==================== éŠæˆ²ç‹€æ…‹ ====================
        let gameState = {
            question: '',
            currentYao: 0,
            currentRound: 0,
            totalSticks: 49,
            results: [],
            phase: 'idle'
        };

        // ==================== DOM å…ƒç´  ====================
        const screens = {
            1: document.getElementById('screen1'),
            2: document.getElementById('screen2'),
            3: document.getElementById('screen3'),
            4: document.getElementById('screen4'),
            5: document.getElementById('screen5')
        };

        const questionInput = document.getElementById('questionInput');
        const questionDisplay = document.getElementById('questionDisplay');
        const resultQuestionDisplay = document.getElementById('resultQuestionDisplay');
        const surveyQuestionDisplay = document.getElementById('surveyQuestionDisplay');
        const middleContent = document.getElementById('middleContent');
        const errorMessage = document.getElementById('errorMessage');
        const status = document.getElementById('status');
        const instruction = document.getElementById('instruction');
        const resultsGrid = document.getElementById('resultsGrid');
        const resultSurveyContainer = document.getElementById('resultSurveyContainer');

        const cells = {
            'top-left': document.getElementById('sticks-top-left'),
            'top-center': document.getElementById('sticks-top-center'),
            'top-right': document.getElementById('sticks-top-right'),
            'bottom-left': document.getElementById('sticks-bottom-left'),
            'bottom-center': document.getElementById('sticks-bottom-center'),
            'bottom-right': document.getElementById('sticks-bottom-right')
        };

        // ==================== ç•«é¢åˆ‡æ› ====================
        function showScreen(screenNumber) {
            Object.values(screens).forEach(screen => screen.classList.remove('active'));
            screens[screenNumber].classList.add('active');
            window.scrollTo(0, 0);
        }

        // ==================== æŒ‰éˆ•äº‹ä»¶ ====================
        // ç•«é¢1 â†’ ç•«é¢2
        document.getElementById('startButton').addEventListener('click', function() {
            const question = questionInput.value.trim();
            if (!question) {
                alert('è«‹å…ˆè¼¸å…¥å•é¡Œï¼');
                return;
            }
            gameState.question = question;
            questionDisplay.textContent = `å•é¡Œï¼š${question}`;
            showScreen(2);
            initializeDivination();
        });

        // é‡æ–°å åœ
        document.getElementById('resetButton').addEventListener('click', resetAll);
        document.getElementById('resetFromResultButton').addEventListener('click', resetAll);

        // ç•«é¢3 â†’ ç•«é¢4
        document.getElementById('toSurveyButton').addEventListener('click', function() {
            surveyQuestionDisplay.textContent = `å•é¡Œï¼š${gameState.question}`;
            showScreen(4);
        });

        // ç•«é¢4 å•å·é¸é …
        document.getElementById('showSimpleSurvey').addEventListener('click', function() {
            resultSurveyContainer.style.display = 'block';
            // é€™è£¡å¯ä»¥å‹•æ…‹è¼‰å…¥ç°¡æ˜“å•å·
            resultSurveyContainer.innerHTML = `
                <div style="padding: 40px; text-align: center; color: #888;">
                    <p style="font-size: 1.2em; margin-bottom: 15px;">ğŸ“ ç°¡æ˜“å•å·å°‡é¡¯ç¤ºæ–¼æ­¤</p>
                    <p>è«‹åœ¨ä»£ç¢¼ä¸­æ’å…¥æ‚¨çš„ Google ç°¡æ˜“å•å·åµŒå…¥ä»£ç¢¼</p>
                </div>
            `;
        });

        document.getElementById('showDetailedSurvey').addEventListener('click', function() {
            resultSurveyContainer.style.display = 'block';
            // é€™è£¡å¯ä»¥å‹•æ…‹è¼‰å…¥è©³ç›¡å•å·
            resultSurveyContainer.innerHTML = `
                <div style="padding: 40px; text-align: center; color: #888;">
                    <p style="font-size: 1.2em; margin-bottom: 15px;">ğŸ“ è©³ç›¡å•å·å°‡é¡¯ç¤ºæ–¼æ­¤</p>
                    <p>è«‹åœ¨ä»£ç¢¼ä¸­æ’å…¥æ‚¨çš„ Google è©³ç›¡å•å·åµŒå…¥ä»£ç¢¼</p>
                </div>
            `;
        });

        document.getElementById('skipToFeedback').addEventListener('click', function() {
            showScreen(5);
        });

        // ç•«é¢4 â†’ ç•«é¢3
        document.getElementById('backToResult').addEventListener('click', function() {
            showScreen(3);
        });

        // ç•«é¢4 â†’ ç•«é¢5
        document.getElementById('toFeedbackSurvey').addEventListener('click', function() {
            showScreen(5);
        });

        // ç•«é¢5 â†’ ç•«é¢3
        document.getElementById('backToResultFromFeedback').addEventListener('click', function() {
            showScreen(3);
        });

        // å®Œæˆ
        document.getElementById('finishButton').addEventListener('click', function() {
            if (confirm('æ„Ÿè¬æ‚¨çš„åƒèˆ‡ï¼æ˜¯å¦è¦é‡æ–°é–‹å§‹å åœï¼Ÿ')) {
                resetAll();
            }
        });

        // ==================== å åœé‚è¼¯ ====================
        function renderSticks(cellId, count, horizontal = false) {
            const cell = cells[cellId];
            cell.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const stick = document.createElement('div');
                stick.className = horizontal ? 'stick horizontal' : 'stick';
                cell.appendChild(stick);
            }

            const parentCell = cell.parentElement;
            let countDisplay = parentCell.querySelector('.stick-count');
            if (countDisplay) countDisplay.remove();
            
            if (count > 0) {
                countDisplay = document.createElement('div');
                countDisplay.className = 'stick-count';
                countDisplay.textContent = count;
                parentCell.appendChild(countDisplay);
            }
        }

        function clearCell(cellId) {
            cells[cellId].innerHTML = '';
            const countDisplay = cells[cellId].parentElement.querySelector('.stick-count');
            if (countDisplay) countDisplay.remove();
        }

        function clearBottomRow() {
            clearCell('bottom-left');
            clearCell('bottom-center');
            clearCell('bottom-right');
        }

        function highlightCell(cellElement) {
            document.querySelectorAll('.grid-cell').forEach(c => c.classList.remove('active'));
            if (cellElement) {
                cellElement.classList.add('active');
            }
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            errorMessage.className = 'error-message';
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 3000);
        }

        function createDividingInterface() {
            middleContent.innerHTML = `
                <div class="dividing-interface">
                    <div class="piles-display">
                        <div class="pile">
                            <div class="pile-label">å·¦å †</div>
                            <div class="pile-sticks" id="leftPileSticks"></div>
                        </div>
                        <div class="pile">
                            <div class="pile-label">å³å †</div>
                            <div class="pile-sticks" id="rightPileSticks"></div>
                        </div>
                    </div>
                    <input type="range" min="4" max="${gameState.totalSticks - 4}" value="${Math.floor(gameState.totalSticks / 2)}" class="slider" id="stickSlider">
                    <button class="button" id="confirmButton">ç¢ºèªåˆ†é…</button>
                </div>
            `;

            const slider = document.getElementById('stickSlider');
            const leftPileSticks = document.getElementById('leftPileSticks');
            const rightPileSticks = document.getElementById('rightPileSticks');
            const confirmButton = document.getElementById('confirmButton');

            slider.addEventListener('input', function() {
                const leftValue = parseInt(this.value);
                const rightValue = gameState.totalSticks - leftValue;
                
                renderPileSticks(leftPileSticks, leftValue);
                renderPileSticks(rightPileSticks, rightValue);
            });

            const initialLeft = parseInt(slider.value);
            renderPileSticks(leftPileSticks, initialLeft);
            renderPileSticks(rightPileSticks, gameState.totalSticks - initialLeft);

            confirmButton.addEventListener('click', () => confirmDivision(slider));
        }

        function renderPileSticks(container, count) {
            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const stick = document.createElement('div');
                stick.className = 'stick';
                container.appendChild(stick);
            }
        }

        function showProcessingSticks(count) {
            middleContent.innerHTML = '';
            const sticksArea = document.createElement('div');
            sticksArea.className = 'sticks-area';
            
            for (let i = 0; i < count; i++) {
                const stick = document.createElement('div');
                stick.className = 'stick';
                sticksArea.appendChild(stick);
            }
            
            middleContent.appendChild(sticksArea);
        }

        async function initializeDivination() {
            gameState = {
                question: gameState.question,
                currentYao: 0,
                currentRound: 0,
                totalSticks: 49,
                results: [],
                phase: 'initializing'
            };

            Object.keys(cells).forEach(clearCell);
            middleContent.innerHTML = '';

            status.textContent = `æº–å‚™å¤§è¡ä¹‹æ•¸...`;
            instruction.textContent = 'å¤§è¡ä¹‹æ•¸äº”åï¼Œå…¶ç”¨å››åæœ‰ä¹';

            // å‹•ç•«ï¼šé¡¯ç¤º50æ ¹æœ¨æ£’
            showProcessingSticks(50);
            highlightCell(document.getElementById('cell-middle'));
            await sleep(1500);

            // å‹•ç•«ï¼šå–å‡º1æ ¹æ”¾åˆ°ä¸­ä¸Š
            status.textContent = 'å–å‡ºä¸€æ ¹æ”¾ç½®æ–¼ä¸­ä¸Šä½ç½®';
            instruction.textContent = 'è™›ä¸€ä¸ç”¨';
            
            // æ·»åŠ ç§»å‹•å‹•ç•«
            const sticks = middleContent.querySelectorAll('.stick');
            if (sticks.length > 0) {
                sticks[0].classList.add('moving');
            }
            
            await sleep(800);
            
            renderSticks('top-center', 1);
            showProcessingSticks(49);
            await sleep(1000);

            gameState.totalSticks = 49;
            gameState.phase = 'idle';

            status.textContent = `${yaoNames[gameState.currentYao]} - ç¬¬ ${gameState.currentRound + 1} è¼ª`;
            instruction.textContent = 'è«‹å°‡æœ¨æ£’åˆ†æˆå…©å †';

            startNextRound();
        }

        function startNextRound() {
            clearBottomRow();
            middleContent.innerHTML = '';

            showProcessingSticks(gameState.totalSticks);
            highlightCell(document.getElementById('cell-middle'));

            setTimeout(() => {
                createDividingInterface();
                gameState.phase = 'dividing';
            }, 500);
        }

        async function confirmDivision(slider) {
            if (gameState.phase !== 'dividing') return;

            const leftValue = parseInt(slider.value);
            const rightValue = gameState.totalSticks - leftValue;

            if (leftValue < 4 || rightValue < 4) {
                showError('æ¯ä¸€å †è‡³å°‘è¦æœ‰4æ ¹æœ¨æ£’ï¼è«‹é‡æ–°åˆ†é…ã€‚');
                return;
            }

            gameState.phase = 'processing';

            let a = leftValue;
            let b = rightValue;

            middleContent.innerHTML = '';
            await sleep(300);

            // æ­¥é©Ÿ1: å·¦å †å–1æ ¹æ”¾åˆ°å·¦ä¸‹
            a = a - 1;
            renderSticks('bottom-left', 1);
            await sleep(800);

            // æ­¥é©Ÿ2: å·¦å †é™¤4å–é¤˜æ•¸ï¼Œæ”¾åˆ°ä¸­ä¸‹
            const leftRemainder = a % 4 === 0 ? 4 : a % 4;
            a = a - leftRemainder;
            renderSticks('bottom-center', leftRemainder);
            await sleep(800);

            // æ­¥é©Ÿ3: å³å †é™¤4å–é¤˜æ•¸ï¼Œæ”¾åˆ°å³ä¸‹
            const rightRemainder = b % 4 === 0 ? 4 : b % 4;
            b = b - rightRemainder;
            renderSticks('bottom-right', rightRemainder);
            await sleep(800);

            // æ­¥é©Ÿ4: ç§»åˆ°å·¦ä¸Šè§’æ©«æ”¾
            const totalBottom = 1 + leftRemainder + rightRemainder;
            clearBottomRow();
            const currentTopLeft = cells['top-left'].querySelectorAll('.stick').length;
            clearCell('top-left');
            renderSticks('top-left', currentTopLeft + totalBottom, true);
            await sleep(800);

            // åˆä½µå‰©é¤˜æœ¨æ£’
            gameState.totalSticks = a + b;
            showProcessingSticks(gameState.totalSticks);
            await sleep(500);

            gameState.currentRound++;
            
            if (gameState.currentRound >= 3) {
                // å®Œæˆä¸€çˆ»
                const yaoValue = gameState.totalSticks / 4;
                gameState.results.push(yaoValue);
                
                status.textContent = `${yaoNames[gameState.currentYao]}å®Œæˆï¼å¾—åˆ°æ•¸å­—ï¼š${yaoValue}`;
                instruction.textContent = gameState.currentYao < 5 ? 'é»æ“Šã€Œç¹¼çºŒã€é€²è¡Œä¸‹ä¸€çˆ»' : 'å åœå®Œæˆï¼';
                
                gameState.currentYao++;
                gameState.currentRound = 0;
                gameState.totalSticks = 49;

                if (gameState.currentYao >= 6) {
                    finishDivination();
                } else {
                    document.getElementById('continueButton').style.display = 'inline-block';
                    middleContent.innerHTML = '';
                    highlightCell(null);
                }
            } else {
                status.textContent = `${yaoNames[gameState.currentYao]} - ç¬¬ ${gameState.currentRound + 1} è¼ª`;
                instruction.textContent = 'è«‹å°‡æœ¨æ£’åˆ†æˆå…©å †';
                await sleep(500);
                startNextRound();
            }
        }

        document.getElementById('continueButton').addEventListener('click', function() {
            this.style.display = 'none';
            clearCell('top-left');
            renderSticks('top-center', 1);
            startNextRound();
        });

        function finishDivination() {
            status.textContent = 'å åœå®Œæˆï¼';
            instruction.textContent = 'å…­å€‹æ•¸å­—å·²å…¨éƒ¨å¾—å‡ºï¼Œé»æ“Šä¸‹æ–¹æŒ‰éˆ•æŸ¥çœ‹çµæœ';
            middleContent.innerHTML = '';
            highlightCell(null);
            
            // é¡¯ç¤ºæŸ¥çœ‹çµæœæŒ‰éˆ•
            document.getElementById('continueButton').style.display = 'none';
            const buttonGroup = document.querySelector('#screen2 .button-group');
            
            // å‰µå»ºæŸ¥çœ‹çµæœæŒ‰éˆ•(å¦‚æœä¸å­˜åœ¨)
            let viewResultButton = document.getElementById('viewResultButton');
            if (!viewResultButton) {
                viewResultButton = document.createElement('button');
                viewResultButton.id = 'viewResultButton';
                viewResultButton.className = 'button';
                viewResultButton.textContent = 'æŸ¥çœ‹å åœçµæœ';
                viewResultButton.addEventListener('click', showResultScreen);
                buttonGroup.insertBefore(viewResultButton, buttonGroup.firstChild);
            }
            viewResultButton.style.display = 'inline-block';
        }

        function showResultScreen() {
            resultQuestionDisplay.textContent = `å•é¡Œï¼š${gameState.question}`;
            
            // è¨ˆç®—å¦åå’Œè®Šçˆ»
            const guaInfo = calculateGua(gameState.results);
            
            resultsGrid.innerHTML = '';
            
            // é¡¯ç¤ºå¦åå’Œè®Šçˆ»è³‡è¨Š
            const guaInfoDiv = document.createElement('div');
            guaInfoDiv.style.cssText = `
                background: rgba(240, 165, 0, 0.15);
                border: 3px solid #f0a500;
                border-radius: 15px;
                padding: 25px;
                margin-bottom: 20px;
                text-align: center;
            `;
            
            const guaNameElement = document.createElement('div');
            guaNameElement.style.cssText = `
                font-size: 2em;
                font-weight: bold;
                color: #f0a500;
                margin-bottom: 15px;
            `;
            guaNameElement.textContent = guaInfo.guaName;
            guaInfoDiv.appendChild(guaNameElement);
            
            if (guaInfo.changingYaos.length > 0) {
                const changingYaoElement = document.createElement('div');
                changingYaoElement.style.cssText = `
                    font-size: 1.3em;
                    color: #ff9500;
                    margin-top: 10px;
                `;
                changingYaoElement.textContent = `è®Šçˆ»ï¼š${guaInfo.changingYaos.join('ã€')}`;
                guaInfoDiv.appendChild(changingYaoElement);
            } else {
                const noChangeElement = document.createElement('div');
                noChangeElement.style.cssText = `
                    font-size: 1.2em;
                    color: #b0b0b0;
                    margin-top: 10px;
                `;
                noChangeElement.textContent = 'ç„¡è®Šçˆ»';
                guaInfoDiv.appendChild(noChangeElement);
            }
            
            resultsGrid.appendChild(guaInfoDiv);
            
            // é¡¯ç¤ºå…­å€‹çˆ»çš„è©³ç´°æ•¸å­—
            gameState.results.forEach((num, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'result-item';
                
                // åˆ¤æ–·æ˜¯å¦ç‚ºè®Šçˆ»ï¼Œæ·»åŠ ç‰¹æ®Šæ¨£å¼
                if (isChangingYao(num)) {
                    itemDiv.style.borderColor = '#ff9500';
                    itemDiv.style.background = 'rgba(255, 149, 0, 0.15)';
                }
                
                itemDiv.innerHTML = `
                    <div class="result-label">${yaoNames[index]}${isChangingYao(num) ? ' âš¡' : ''}</div>
                    <div class="result-number">${num}</div>
                `;
                resultsGrid.appendChild(itemDiv);
            });
            
            showScreen(3);
        }

        function resetAll() {
            gameState = {
                question: '',
                currentYao: 0,
                currentRound: 0,
                totalSticks: 49,
                results: [],
                phase: 'idle'
            };

            Object.keys(cells).forEach(clearCell);
            middleContent.innerHTML = '';
            questionInput.value = '';
            resultsGrid.innerHTML = '';
            document.getElementById('continueButton').style.display = 'none';
            
            // éš±è—æŸ¥çœ‹çµæœæŒ‰éˆ•
            const viewResultButton = document.getElementById('viewResultButton');
            if (viewResultButton) {
                viewResultButton.style.display = 'none';
            }
            
            showScreen(1);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // åˆå§‹åŒ–
        renderSticks('top-center', 1);
    </script>
</body>
</html>
